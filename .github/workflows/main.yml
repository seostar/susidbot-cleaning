name: Cleaner Bot
on:
  schedule:
    - cron: '0 21 * * *'      # –©–æ–¥–Ω—è –æ 23:00 (–æ–Ω–æ–≤–ª–µ–Ω–Ω—è —ñ—Å—Ç–æ—Ä—ñ—ó)
    - cron: '0 7 1 * *'       # 1-—à–µ —á–∏—Å–ª–æ –æ 09:00 (–∑–≤—ñ—Ç)
    - cron: '0 10 11 * *'     # 11-—Ç–µ —á–∏—Å–ª–æ –æ 12:00 (–∑–≤—ñ—Ç)
    - cron: '0 10 19 * *'     # 19-—Ç–µ —á–∏—Å–ª–æ –æ 12:00 (–∑–≤—ñ—Ç)
  workflow_dispatch:          # –ö–Ω–æ–ø–∫–∞ –¥–ª—è —Ä—É—á–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫—É

permissions:
  contents: write

jobs:
  run-bot:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
        with:
          fetch-depth: 0 # –ü–æ—Ç—Ä—ñ–±–Ω–æ –¥–ª—è –∫–æ—Ä–µ–∫—Ç–Ω–æ–≥–æ git push

      - uses: actions/setup-python@v4
        with: {python-version: '3.9'}

      - run: pip install pyTelegramBotAPI pytz

      - name: Run
        env:
          TELEGRAM_TOKEN: ${{ secrets.TELEGRAM_TOKEN }}
          CHAT_ID: ${{ secrets.CHAT_ID }}
          THREAD_ID: ${{ secrets.THREAD_ID }}
          GITHUB_EVENT_NAME: ${{ github.event_name }}
        run: python bot.py

      - name: Sync
        run: |
          git config --global user.name "github-actions[bot]"
          git config --global user.email "github-actions[bot]@users.noreply.github.com"
          git add history.json
          # –Ø–∫—â–æ —Ñ–∞–π–ª –∑–º—ñ–Ω–∏–≤—Å—è ‚Äî –∑–±–µ—Ä—ñ–≥–∞—î–º–æ, —è–∫—â–æ –Ω—ñ ‚Äî —ñ–¥–µ–º–æ –¥–∞–ª—ñ
          if ! git diff --cached --quiet; then
            git commit -m "ü§ñ –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è —ñ—Å—Ç–æ—Ä—ñ—ó –æ–ø–ª–∞—Ç"
            git pull --rebase origin main
            git push
          else
            echo "–ó–º—ñ–Ω —É history.json –Ω–µ–º–∞—î."
          fi
